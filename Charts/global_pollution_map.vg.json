{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": {
    "offset": 8,
    "fontSize": 21,
    "fontWeight": "bold",
    "anchor": "middle"
  },
  "width": 1250,
  "height": 720,
  "background": "#d5e6eb",
  "padding": {"left": 0, "right": 0, "top": 0, "bottom": 0},
  "view": {"stroke": null},
  "projection": { "type": "equalEarth", "scale": 240 },
  "bounds": "flush",
  "layer": [
    {
      "name": "ocean",
      "data": {
        "url": "https://raw.githubusercontent.com/HongSze/FIT3179_DataVisualisation2/refs/heads/main/ne_50m_worldmap_countries.json",
        "format": {"type": "topojson", "feature": "ne_50m_ocean"}
      },
      "mark": {"type": "geoshape"},
      "encoding": {"fill": {"value": "#7cb9e8"}}
    },
    {
      "name": "countries_choropleth",
      "data": {
        "url": "https://raw.githubusercontent.com/HongSze/FIT3179_DataVisualisation2/refs/heads/main/ne_50m_worldmap_countries.json",
        "format": {"type": "topojson", "feature": "ne_50m_admin_0_countries"}
      },
      "transform": [
        {"calculate": "datum.properties.ADMIN || datum.properties.admin", "as": "ADMIN"},
        {"calculate": "datum.properties.ADM0_A3 || datum.properties.adm0_a3", "as": "A3"},
        {"filter": "!(datum.ADMIN=='Antarctica' || datum.A3=='ATA')"},
        {
          "lookup": "ADMIN",
          "from": {
            "data": {
              "url": "https://raw.githubusercontent.com/HongSze/FIT3179_DataVisualisation2/refs/heads/main/Dataset/global_air_pollution_cleaned.csv",
              "format": {"type": "csv"}
            },
            "key": "Country",
            "fields": ["Mean Overall AQI"]
          }
        },
        {"calculate": "toNumber(datum['Mean Overall AQI'])", "as": "aqi_mean"},
        {
          "window": [{"op": "rank", "as": "rank_worst"}],
          "sort": [{"field": "aqi_mean", "order": "descending"}]
        },
        {
          "joinaggregate": [{"op": "count", "field": "aqi_mean", "as": "n_with_aqi"}]
        },
        {
          "calculate": "isValid(datum.aqi_mean) ? format(datum.rank_worst, 'd') + ' of ' + format(datum.n_with_aqi, 'd') : 'â€”'",
          "as": "rank_str"
        },
        {
          "calculate": "isValid(datum.aqi_mean) ? (datum.aqi_mean <= 50 ? 'Good (0-50)' : datum.aqi_mean <= 100 ? 'Moderate (51-100)' : datum.aqi_mean <= 150 ? 'Unhealthy-Sensitive People (101-150)' : 'Unhealthy (151-200)') : null",
          "as": "aqi_level_label"
        },
        {"calculate": "isValid(datum.aqi_mean) ? format(datum.aqi_mean, '.1f') : 'No data'", "as": "aqi_mean_str"},
        {"calculate": "isValid(datum.aqi_level_label) ? datum.aqi_level_label : 'No data'", "as": "aqi_level_str"}
      ],
      "params": [
        {
          "name": "countries_highlight",
          "select": {"type": "point", "fields": ["aqi_level_label"], "toggle": "true"},
          "bind": "legend"
        }
      ],
      "mark": {"type": "geoshape"},
      "encoding": {
        "color": {
          "condition": {
            "test": "isValid(datum.aqi_level_label)",
            "field": "aqi_level_label",
            "type": "nominal",
            "title": "Air Pollution Level (Click to filter)",
            "scale": {
              "domain": [
                "Good (0-50)",
                "Moderate (51-100)",
                "Unhealthy-Sensitive People (101-150)",
                "Unhealthy (151-200)"
              ],
              "range": ["#fdcc8a", "#fc8d59", "#e34a33", "#b30000"]
            },
            "legend": {
              "orient": "none",
              "legendX": 20,
              "legendY": 300,
              "padding": 8,
              "cornerRadius": 8,
              "fillColor": "white",
              "strokeColor": "#000000",
              "labelFontSize": 12,
              "titleFontSize": 14,
              "titleLimit": 1000,
              "labelLimit": 600,
              "symbolType": "square"
            }
          },
          "value": "#8f8f8f"
        },
        "opacity": { "condition": { "param": "countries_highlight", "value": 0.6 }, "value": 0.1 },
        "stroke": {"value": "#000000"},
        "strokeWidth": {"value": 0.4},
        "tooltip": [
          {"field": "ADMIN", "title": "Country"},
          {"field": "aqi_mean_str", "title": "Mean AQI"},
          {"field": "aqi_level_str", "title": "Level"},
          {"field": "rank_str", "title": "Rank (worst = 1)"}
        ]
      }
    },
    {
      "name": "graticules",
      "data": {
        "url": "https://raw.githubusercontent.com/HongSze/FIT3179_DataVisualisation2/refs/heads/main/ne_50m_worldmap_countries.json",
        "format": {"type": "topojson", "feature": "ne_50m_graticules_15"}
      },
      "mark": {"type": "geoshape"},
      "encoding": {
        "fill": {"value": null},
        "stroke": {"value": "#8ea3b3"},
        "strokeWidth": {"value": 1.0},
        "opacity": {"value": 0.8}
      }
    },
    {
      "name": "annotationText",
      "data": { "values": [
        { "note": "ð— ð—®ð—¹ð—®ð˜†ð˜€ð—¶ð—® ranks ðŸ±ðŸ­ð˜€ð˜ in terms \nof ð˜„ð—¼ð—¿ð˜€ð˜ ð—®ð—¶ð—¿ ð—¾ð˜‚ð—®ð—¹ð—¶ð˜ð˜† compared to \nthe ð—¼ð˜ð—µð—²ð—¿ ðŸ®ðŸ°ðŸ­ ð—°ð—¼ð˜‚ð—»ð˜ð—¿ð—¶ð—²ð˜€." }
      ]},
      "mark": {
        "type": "text",
        "fontSize": 13,
        "align": "left",
        "baseline": "top",
        "lineBreak": "\n",
        "color": "#333333"
      },
      "encoding": {
        "x": { "value": 820 },
        "y": { "value": 400 },
        "text": { "field": "note" }
      }
    },
    {
      "name": "annotationText2",
      "data": { "values": [
        { "note": "ð—•ð—®ð—µð—¿ð—®ð—¶ð—», ð— ð—®ð˜‚ð—¿ð—¶ð˜ð—®ð—»ð—¶ð—®, and \nð—£ð—®ð—¸ð—¶ð˜€ð˜ð—®ð—» rank among the \nð˜„ð—¼ð—¿ð˜€ð˜ ð—®ð—¶ð—¿ ð—¾ð˜‚ð—®ð—¹ð—¶ð˜ð˜† globally."}
      ]},
      "mark": {
        "type": "text",
        "fontSize": 13,
        "align": "left",
        "baseline": "top",
        "lineBreak": "\n",
        "color": "#333333"
      },
      "encoding": {
        "x": { "value": 400 },
        "y": { "value": 200 },
        "text": { "field": "note" }
      }
    }
  ]
}
