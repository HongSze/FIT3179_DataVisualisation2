{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": {
    "text": "PM (µg/m³) on left • Gases (ppm) on right",
    "offset": 8,
    "fontSize": 16,
    "fontWeight": "bold",
    "anchor": "middle"
  },
  "data": { "url": "https://raw.githubusercontent.com/HongSze/FIT3179_DataVisualisation2/refs/heads/main/Dataset/air_pollution.csv" },
  "width": 820,
  "height": 450,
  "background": "#d5e6eb",
  "padding": { "top": 0, "right": 10, "bottom": 0, "left": 10 },

  "params": [
    {
      "name": "pollutantSelect",
      "value": "All",
      "bind": {
        "input": "select",
        "name": " Pollutant ",
        "options": ["All","PM 2.5","PM 10","CO","NO2","SO2","O3"]
      }
    }
  ],

  "encoding": {
    "x": { "field": "date", "type": "temporal", "timeUnit": "yearmonth", "title": "Month" },
    "color": {
      "field": "pollutant",
      "type": "nominal",
      "title": "Pollutant",
      "scale": {
        "domain": ["PM 2.5","PM 10","CO","NO2","SO2","O3"],
        "range": [
          "#7C6BD0",  
          "#FF9F1C",
          "#2F7EBC",  
          "#CC79A7", 
          "#5C677D", 
          "#00BFC4" 
        ]
      },
      "legend": {
        "labelFontSize": 13,
        "titleFontSize": 15,
        "symbolSize": 110,
        "symbolStroke": "#ffffff",
        "symbolStrokeWidth": 0.8
      }
    }
  },

  "layer": [
    
    {
      "transform": [
        { "filter": "datum.pollutant == 'PM 2.5' || datum.pollutant == 'PM 10'" },
        { "calculate": "toNumber(datum.concentration)", "as": "conc_num" },
        { "filter": "isValid(datum.conc_num)" },
        { "filter": "toDate(datum.date) >= toDate('2018-01-01')" },
        { "filter": "pollutantSelect == 'All' || datum.pollutant == pollutantSelect" }
      ],
      "mark": {
        "type": "line",
        "strokeDash": [4,3],
        "strokeWidth": 2,
        "interpolate": "monotone",
        "point": { "filled": true, "size": 55, "stroke": "white", "strokeWidth": 1 }
      },
      "encoding": {
        "y": {
          "field": "conc_num",
          "type": "quantitative",
          "title": "Concentration (µg/m³) - dashed",
          "axis": { "grid": true }
        },
        "tooltip": [
          { "field": "pollutant", "title": "Pollutant" },
          { "field": "date", "type": "temporal", "timeUnit": "yearmonth", "title": "Month" },
          { "field": "conc_num", "type": "quantitative", "title": "Concentration (µg/m³)", "format": ".1f" }
        ]
      }
    },

   
    {
      "transform": [
        { "filter": "datum.pollutant == 'CO' || datum.pollutant == 'NO2' || datum.pollutant == 'SO2' || datum.pollutant == 'O3'" },
        { "calculate": "toNumber(datum.concentration)", "as": "conc_num" },
        { "filter": "isValid(datum.conc_num)" },
        { "filter": "toDate(datum.date) >= toDate('2018-01-01')" },
        { "filter": "pollutantSelect == 'All' || datum.pollutant == pollutantSelect" }
      ],
      "mark": {
        "type": "line",
        "strokeWidth": 2,
        "interpolate": "monotone",
        "point": { "filled": true, "size": 55, "stroke": "white", "strokeWidth": 1 }
      },
      "encoding": {
        "y": {
          "field": "conc_num",
          "type": "quantitative",
          "title": "Concentration (ppm) - solid",
          "axis": { "orient": "right", "grid": false }
        },
        "tooltip": [
          { "field": "pollutant", "title": "Pollutant" },
          { "field": "date", "type": "temporal", "timeUnit": "yearmonth", "title": "Month" },
          { "field": "conc_num", "type": "quantitative", "title": "Concentration (ppm)", "format": ".3~g" }
        ]
      }
    },

    {
      "name": "annotationText",
      "data": { "values": [
        { "note": "In 𝗦𝗲𝗽𝘁𝗲𝗺𝗯𝗲𝗿 𝟮𝟬𝟭𝟵, 𝘁𝗿𝗮𝗻𝘀𝗯𝗼𝘂𝗻𝗱𝗮𝗿𝘆 𝗵𝗮𝘇𝗲 from \n𝗜𝗻𝗱𝗼𝗻𝗲𝘀𝗶𝗮𝗻 𝗳𝗼𝗿𝗲𝘀𝘁 and 𝗽𝗲𝗮𝘁 𝗳𝗶𝗿𝗲𝘀 blanketed Malaysia, \nspiking 𝗯𝗼𝘁𝗵 𝗣𝗠 and 𝗴𝗮𝘀𝗲𝗼𝘂𝘀 𝗽𝗼𝗹𝗹𝘂𝘁𝗮𝗻𝘁𝘀."}
      ]},
      "mark": {
        "type": "text",
        "fontSize": 13,
        "align": "left",
        "baseline": "top",
        "lineBreak": "\n",
        "color": "black"
      },
      "encoding": {
        "x": { "value": 310 },
        "y": { "value": 48 },
        "text": { "field": "note" },
        "color": { "value": "#333333" }
      }
    },

    {
      "name": "sep2019-line",
      "data": { "values": [ { "date": "2019-09-01" } ] },
      "mark": {
        "type": "rule",
        "stroke": "#0f172a",
        "strokeDash": [6,4],
        "strokeWidth": 2,
        "opacity": 0.85
      },
      "encoding": {
        "x": { "field": "date", "type": "temporal" },
        "tooltip": [{ "value": "Sep 2019 haze event" }]
      }
    }
  ],

  "resolve": { "scale": { "y": "independent", "color": "shared" } }
}
