{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": {
    "text": "PM (µg/m³) on left • Gases (ppm) on right",
    "offset": 8,
    "fontSize": 16,
    "fontWeight": "bold",
    "anchor": "middle"
  },
  "data": { "url": "https://raw.githubusercontent.com/HongSze/FIT3179_DataVisualisation2/refs/heads/main/Dataset/air_pollution.csv" },
  "width": 1090,
  "height": 450,
  "background": "#d5e6eb",
  "padding": { "top": 0, "right": 5, "bottom": 5, "left": 0 },

  "params": [
    {
      "name": "pollutantSelect",
      "value": "All",
      "bind": {
        "input": "select",
        "name": " Pollutant ",
        "options": ["All","PM 2.5","PM 10","CO","NO2","SO2","O3"]
      }
    }
  ],

  "encoding": {
    "x": { "field": "date", "type": "temporal", "timeUnit": "yearmonth", "title": "Month" },
    "color": {
      "field": "pollutant",
      "type": "nominal",
      "title": "Pollutant",
      "scale": {
        "domain": ["PM 2.5","PM 10","CO","NO2","SO2","O3"],
        "range":  ["#d62728","#ff7f0e","#1f77b4","#9467bd","#2ca02c","#17becf"]
      },
      "legend": {
        "labelFontSize": 13,
        "titleFontSize": 15,
        "symbolSize": 100
      }
    }
  },

  "layer": [
    {
      "transform": [
        { "filter": "datum.pollutant == 'PM 2.5' || datum.pollutant == 'PM 10'" },
        { "calculate": "toNumber(datum.concentration)", "as": "conc_num" },
        { "filter": "isValid(datum.conc_num)" },
        { "filter": "toDate(datum.date) >= toDate('2018-01-01')" },
        { "filter": "pollutantSelect == 'All' || datum.pollutant == pollutantSelect" }
      ],
      "mark": { "type": "line", "point": true, "strokeWidth": 2, "interpolate": "monotone" },
      "encoding": {
        "y": {
          "field": "conc_num",
          "type": "quantitative",
          "title": "Concentration (µg/m³)",
          "axis": { "grid": true }
        },
        "tooltip": [
          { "field": "pollutant", "title": "Pollutant" },
          { "field": "date", "type": "temporal", "timeUnit": "yearmonth", "title": "Month" },
          { "field": "conc_num", "type": "quantitative", "title": "Concentration (µg/m³)", "format": ".1f" }
        ]
      }
    },
    {
      "transform": [
        { "filter": "datum.pollutant == 'CO' || datum.pollutant == 'NO2' || datum.pollutant == 'SO2' || datum.pollutant == 'O3'" },
        { "calculate": "toNumber(datum.concentration)", "as": "conc_num" },
        { "filter": "isValid(datum.conc_num)" },
        { "filter": "toDate(datum.date) >= toDate('2018-01-01')" },
        { "filter": "pollutantSelect == 'All' || datum.pollutant == pollutantSelect" }
      ],
      "mark": { "type": "line", "point": true, "strokeDash": [4,3], "strokeWidth": 2, "interpolate": "monotone" },
      "encoding": {
        "y": {
          "field": "conc_num",
          "type": "quantitative",
          "title": "Concentration (ppm)",
          "axis": { "orient": "right", "grid": false }
        },
        "tooltip": [
          { "field": "pollutant", "title": "Pollutant" },
          { "field": "date", "type": "temporal", "timeUnit": "yearmonth", "title": "Month" },
          { "field": "conc_num", "type": "quantitative", "title": "Concentration (ppm)", "format": ".3~g" }
        ]
      }
    },
    {
      "name": "annotationText",
      "data": { "values": [
        { "note": "In September 2019, transboundary haze from \nIndonesian forest and peat fires blanketed Malaysia, \nspiking both PM and gaseous pollutants." }
      ]},
      "mark": {
        "type": "text",
        "fontSize": 13,
        "align": "left",
        "baseline": "top",
        "lineBreak": "\n",
        "color": "black"
      },
      "encoding": {
        "x": { "value": 430 },
        "y": { "value": 48 },
        "text": { "field": "note" },
        "color": { "value": "black" }
      }
    }
  ],

  "resolve": { "scale": { "y": "independent", "color": "shared" } }
}
